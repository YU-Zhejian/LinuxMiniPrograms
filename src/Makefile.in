# TODO: BSD Make
# VERSION=1.2
export MKDIR = mkdir -p
export TT =
# Disable implicit rules and variables
MAKEFLAGS += --no-builtin-rules
.SUFFIXES:

ETC_SOURCES := $(notdir $(wildcard src/etc/*))
ETC_OBJECTS := $(foreach fn, $(ETC_SOURCES), $(addprefix etc/, $(fn)))

.PHONY : all

.PHONY: doc
doc: share/doc/pdf share/doc/html share/doc/usage share/man

.PHONY: etc
etc : $(ETC_OBJECTS)

etc/%: src/etc/%
	$(CP) $< $@

.PHONY: var
var:
	$(MKDIR) -p var/
	$(CP) src/var/* var/

.PHONY: C
C:
	@-$(MAKE) -C src/C

.PHONY: share/doc/pdf
share/doc/pdf:
	@-$(MAKE) -C src/doc pdf

.PHONY: share/doc/html
share/doc/html:
	@-$(MAKE) -C src/doc html

.PHONY: share/man
share/man:
	@-$(MAKE) -C src/doc man

.PHONY: share/doc/usage
share/doc/usage:
	@-$(MAKE) -C src/doc usage

.PHONY: pp
pp:
	bash src/exec/install_path_permissions.sh
	@-$(MAKE) -C opt permissions

.PHONY: test
test:
	@-$(MAKE) -C src/test TT=$(TT)

.PHONY: pytest
pytest:
	bash src/pytest/00_index.sh $(TT)

.PHONY: clean
clean:
	$(RM) etc/path.conf
	@-$(MAKE) -C src/test clean
	@-$(MAKE) -C src/C clean

.PHONY: distclean
distclean:clean
	$(RM) etc var share GNUmakefile
	@-$(MAKE) -C src/test distclean
	@-$(MAKE) -C src/C distclean

.PHONY: test_list
test_list:
	ls src/test/ | grep '\.t\.sh' | sed 's;\.t\.sh;;'

# TODO: Implement installation
#install:
#	$(CP) -buv . ~/opt/LinuxMiniPrograms/ &>> install.log
#
#uninstall:
#	bash -c 'cat install.log |  | while read line;do '
