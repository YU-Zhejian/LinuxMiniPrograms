#!/usr/bin/env bash
VERSION=1.2
set -ue
DN="$(readlink -f "$(dirname "${0}")")"
WD="$(pwd)"
. "${DN}"/../etc/path.conf
. "${DN}"/../lib/libstr
. "${DN}"/../lib/libisopt
ylsjsd start
# ============ Possess arguments ============
STDS=()
UKOPT=()
HAVEHELP=false
HAVEVER=false
# ============ Possess arguments ============
for opt in "${@}"; do
	if isopt "${opt}"; then
		case "${opt}" in
		"-x")
			set -x
			;;
		"-h" | "--help")
			HAVEHELP=true
			UKOPT=("${UKOPT[@]}" "${opt}")
			;;
		"-v" | "--version")
			HAVEVER=true
			UKOPT=("${UKOPT[@]}" "${opt}")
			;;
		*)
			UKOPT=("${UKOPT[@]}" "${opt}")
		esac
	else
		STDS=("${STDS[@]}" "${opt}")
	fi
done
ylcmd=${STDS[0]:-}
unset STDS[0]

if [ "${ylcmd}" = "lscmd" ];then
	ls -1 "${DN}"/exec/ylsjs/ | grep -v lib | sed 's;\.sh$;;'
elif [ -f "${DN}"/exec/ylsjs/"${ylcmd}".sh ]; then
	. "${DN}"/exec/ylsjs/"${ylcmd}".sh
elif [ -f "${DN}"/exec/ylsjs/"${ylcmd}".py ]; then
	IFS="${OLD_IFS}"
	if [ "${mypython}" != "ylukh" ]; then
		"${mypython}" "${DN}"/exec/ylsjs/"${sjscmd}".py "${@}"
	else
		errh "Python not found"
	fi
elif [ -z "${ylcmd}" ];then
	${HAVEHELP} && yldoc ylsjs
	${HAVEVER} && echo "${VERSION}"
else
	IFS="${OLD_IFS}"
	errh "subcommand '${ylcmd}' invalid. Use '${0} lscmd' to get a list of available commands"
fi
