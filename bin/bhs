#!/usr/bin/env bash
# BHS V1P6
set -ue
DN="$(readlink -f "$(dirname "${0}")")"
. "${DN}"/../etc/path.sh
more="${mymore}"
. "${DN}"/../lib/libisopt
. "${DN}"/../lib/libstr
infoh "YuZJLab Bash History Searcher"
infoh "Copyright (C) 2019-2020 YU Zhejian"
STDS=""
for opt in "${@}"; do
	if isopt "${opt}"; then
		case "${opt}" in
		"-h" | "--help")
			yldoc bhs
			exit 0
			;;
		"-v" | "--version")
			echo "Version 1 Patch 6"
			exit 0
			;;
		--more\:*)
			more="${opt:7}"
			if $("${more}" --help &>/dev/null;echo ${?}) -eq 127; then
				warnh "Invalid More '${more}'! Will use original '${mymore}' instead"
				more="${mymore}"
			else
				infoh "Will use '${more}' as More"
			fi
			;;
		*)
			warnh "Option '${opt}' invalid. Ignored"
			;;
		esac
	else
		STDS="${STDS}${opt} "
	fi
done
STDS=$(echo "${STDS}"|"${mysed}" "s/ $//")
if [ -n "${STDS}" ]; then
	echo \"${STDS}\"
	"${mycat}" -n ~/.bash_history | "${mygrep}" --color=auto -- "${STDS}" | "${more}"
else
	"${mycat}" -n ~/.bash_history | "${more}"
fi
