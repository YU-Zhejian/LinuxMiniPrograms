#!/usr/bin/env python
# YLSYSINFO.py V1
from LMP_Pylib.libisopt import *
from LMP_Pylib.libmktbl import *
import os,sys,re
cmd=0
for sysarg in sys.argv[2:]:
    if isopt(sysarg):
        if sysarg=='-h' or sysarg=='--help':
            print("No documentation for this product. Use 'ylsysinfo' right away or '-v|--version' option for version information..")
            exit(0)
        elif sysarg=='-v' or sysarg=='--version':
            print('Version 1')
            exit(0)
print("\033[033mChecking operating systems:\033[0m")
if os.path.isfile("/proc/version"):
    print("\033[033mSystem information generated by '/proc/version':\033[0m")
    verstr=ylread("/proc/version").strip()
    print(verstr)
    verstrs=verstr.split(" ")
    tbl=["#1","#1"]
    tbl.append("System type;"+verstrs[0])
    tbl.append("Kernel version;"+verstrs[2])
    tbl.append("Kernel built by;"+verstrs[3][1:-1])
    gcc_ct_l=re.findall(r'\(.+\)',' '.join(verstrs[4:]))[0][1:-1].replace("gcc version ","").split(' ')
    tbl.append("Kernel built using GCC version;" + gcc_ct_l[0])
    tbl.append("Kernel built using GCC released on;" + gcc_ct_l[1])
    gcc_ct_l = re.findall(r'\(.+?\)', ' '.join(gcc_ct_l[2:]))[0][1:-1].split(' ')
    tbl.append("Kernel built using GCC on platform;" + ' '.join(gcc_ct_l[0:-1]))
    tbl.append("Kernel built using GCC version (detailed);" + gcc_ct_l[-1])
    tbl.append("Kernel built on date;"+re.findall(".*\)(.*)",verstr)[0].replace("#1 SMP","").strip())
    tmpf=mktemp("ylsysinfo.XXXXX")
    ylwrite(tmpf,'\n'.join(tbl))
    mktbl(tmpf)
    os.remove(tmpf)
else:
    print("\033[031mFailed to read '/proc/version'\033[0m")

if not os.system("uname -a &>>/dev/null"):
    print("\033[033mSystem information generated by 'uname -a':\033[0m")
    verstr=yldo("uname -a")
    print(verstr)
    verstrs=verstr.split(" ")
    tbl=["#1","#1"]
    tbl.append("System type;"+verstrs[0])
    tbl.append("Kernel version;"+verstrs[2])
    tbl.append("Kernel architecture;"+verstrs[-1]+" "+verstrs[-2])
    tbl.append("Kernel built on date;"+" ".join(verstrs[3:-3]).replace("#1 SMP","").strip())
    tbl.append("Network host name;" + verstrs[1])
    tmpf=mktemp("ylsysinfo.XXXXX")
    ylwrite(tmpf,'\n'.join(tbl))
    mktbl(tmpf)
    os.remove(tmpf)
else:
    print("\033[031mFailed to execute 'uname -a'\033[0m")
print("\033[033mChecking users:\033[0m")
if not os.system("id -a &>> /dev/null || id &>> /dev/null"):
    print("\033[033mSystem information generated by 'id -a||id':\033[0m")
    verstr=yldo("uname -a")

exit(0)
